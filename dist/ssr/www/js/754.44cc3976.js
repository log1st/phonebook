"use strict";(self["webpackChunkphonebook"]=self["webpackChunkphonebook"]||[]).push([[754],{1879:(e,n,t)=>{t.d(n,{s:()=>r});var o=t(3673),a=t(2323),i=t(8880);const l={class:"text-h6"};function r(e,n,t,r,s,u){const d=(0,o.up)("q-input"),c=(0,o.up)("q-select"),p=(0,o.up)("q-card-section"),m=(0,o.up)("q-btn"),g=(0,o.up)("q-card-actions"),f=(0,o.up)("q-card"),v=(0,o.up)("q-dialog");return(0,o.wg)(),(0,o.j4)(v,{ref:"dialogRef",class:(0,a.C_)(e.$style.dialog),onHide:e.onDialogHide},{default:(0,o.w5)((()=>[(0,o.Wm)(f,{tag:"form",onSubmit:(0,i.iM)(e.submit,["prevent"]),class:"q-dialog-plugin"},{default:(0,o.w5)((()=>[(0,o.Wm)(p,null,{default:(0,o.w5)((()=>[(0,o._)("div",l,(0,a.zw)(e.id?"Редактирование":"Создание")+" департамента",1),(0,o.Wm)(d,{autofocus:"",modelValue:e.model.name,"onUpdate:modelValue":n[0]||(n[0]=n=>e.model.name=n),label:"Название"},null,8,["modelValue"]),(0,o.Wm)(c,{modelValue:e.model.parentId,"onUpdate:modelValue":n[1]||(n[1]=n=>e.model.parentId=n),options:e.departments.filter((n=>n.id!==e.id)),"option-value":"id","option-label":"name",label:"Родитель",clearable:"","map-options":"",disable:!e.id,autocomplete:""},null,8,["modelValue","options","disable"])])),_:1}),(0,o.Wm)(g,{align:"right"},{default:(0,o.w5)((()=>[(0,o.Wm)(m,{color:"primary",flat:"",label:"Отмена",onClick:e.onCancelClick},null,8,["onClick"]),(0,o.Wm)(m,{type:"submit",label:e.id?"Сохранить":"Создать",color:"primary",onClick:e.onOKClick,loading:e.isLoading},null,8,["label","onClick","loading"])])),_:1})])),_:1},8,["onSubmit"])])),_:1},8,["class","onHide"])}},6960:(e,n,t)=>{t.d(n,{s:()=>r});var o=t(3673),a=t(2323),i=t(8880);const l=(0,o._)("div",{class:"text-h6"},"Вход",-1);function r(e,n,t,r,s,u){const d=(0,o.up)("q-card-section"),c=(0,o.up)("q-input"),p=((0,o.up)("q-checkbox"),(0,o.up)("q-btn")),m=(0,o.up)("q-card-actions"),g=(0,o.up)("q-card"),f=(0,o.up)("q-dialog"),v=(0,o.Q2)("close-popup");return(0,o.wg)(),(0,o.j4)(f,{class:(0,a.C_)(e.$style.dialog),ref:"dialogRef",modelValue:e.localValue,"onUpdate:modelValue":n[3]||(n[3]=n=>e.localValue=n)},{default:(0,o.w5)((()=>[(0,o.Wm)(g,{style:{minWidth:"350px"},tag:"form",onSubmit:(0,i.iM)(e.submit,["prevent"])},{default:(0,o.w5)((()=>[(0,o.Wm)(d,null,{default:(0,o.w5)((()=>[l])),_:1}),(0,o.Wm)(d,null,{default:(0,o.w5)((()=>{var t,a;return[(0,o.Wm)(c,{ref:"loginInputRef","error-message":null===(t=e.errorsMap.login)||void 0===t?void 0:t.join("\n"),error:"login"in e.errorsMap,dense:"",modelValue:e.model.login,"onUpdate:modelValue":n[0]||(n[0]=n=>e.model.login=n),label:"Логин",autofocus:""},null,8,["error-message","error","modelValue"]),(0,o.Wm)(c,{"error-message":null===(a=e.errorsMap.password)||void 0===a?void 0:a.join("\n"),error:"password"in e.errorsMap,dense:"",modelValue:e.model.password,"onUpdate:modelValue":n[1]||(n[1]=n=>e.model.password=n),label:"Пароль",autofocus:""},null,8,["error-message","error","modelValue"]),(0,o.kq)("",!0)]})),_:1}),(0,o.Wm)(m,{align:"right",class:"text-primary"},{default:(0,o.w5)((()=>[(0,o.wy)((0,o.Wm)(p,{flat:"",label:"Отмена"},null,512),[[v]]),(0,o.Wm)(p,{color:"primary",label:"Войти",loading:e.isSigningIn,type:"submit"},null,8,["loading"])])),_:1})])),_:1},8,["onSubmit"])])),_:1},8,["class","modelValue"])}},1585:(e,n,t)=>{t.d(n,{s:()=>s});var o=t(3673),a=t(2323);const i=(0,o.Uk)(" Телефонная книжка "),l=(0,o.Uk)("Выйти"),r=(0,o.Uk)("Войти");function s(e,n,t,s,u,d){const c=(0,o.up)("q-btn"),p=(0,o.up)("q-toolbar-title"),m=(0,o.up)("q-checkbox"),g=(0,o.up)("q-toolbar"),f=(0,o.up)("q-header"),v=(0,o.up)("router-view"),h=(0,o.up)("q-page-container"),Z=(0,o.up)("SignInDialog"),w=(0,o.up)("q-layout");return(0,o.wg)(),(0,o.j4)(w,{view:"lHh Lpr lFf"},{default:(0,o.w5)((()=>[(0,o.Wm)(f,{elevated:""},{default:(0,o.w5)((()=>[(0,o.Wm)(g,null,{default:(0,o.w5)((()=>[(0,o.Wm)(p,null,{default:(0,o.w5)((()=>[(0,o.Wm)(c,{to:{name:"index"},flat:"","no-caps":"","no-wrap":""},{default:(0,o.w5)((()=>[i])),_:1})])),_:1}),e.isAuthorized?((0,o.wg)(),(0,o.iD)(o.HY,{key:0},[(0,o.Wm)(c,{"no-caps":"",flat:"",class:"no-pointer-events"},{default:(0,o.w5)((()=>[(0,o.Uk)(" Привет, "+(0,a.zw)(e.userData.login),1)])),_:1}),e.can(["admin","root"])?((0,o.wg)(),(0,o.j4)(m,{key:0,modelValue:e.isEditing,"onUpdate:modelValue":n[0]||(n[0]=n=>e.isEditing=n),color:"red",dark:"",class:"q-mr-md",label:"Режим редактирования"},null,8,["modelValue"])):(0,o.kq)("",!0),(0,o.Wm)(c,{color:"red",onClick:e.signOut,loading:e.isSigningOut},{default:(0,o.w5)((()=>[l])),_:1},8,["onClick","loading"])],64)):((0,o.wg)(),(0,o.j4)(c,{key:1,flat:"",onClick:e.toggleSignInDialog},{default:(0,o.w5)((()=>[r])),_:1},8,["onClick"]))])),_:1})])),_:1}),(0,o.Wm)(h,null,{default:(0,o.w5)((()=>[(0,o.Wm)(v)])),_:1}),(0,o.Wm)(Z,{modelValue:e.isSignInDialogVisible,"onUpdate:modelValue":n[1]||(n[1]=n=>e.isSignInDialogVisible=n)},null,8,["modelValue"])])),_:1})}},2150:(e,n,t)=>{t.d(n,{Z:()=>u});var o=t(3673),a=t(1959),i=t(9022),l=t(2734),r=function(e,n,t,o){function a(e){return e instanceof t?e:new t((function(n){n(e)}))}return new(t||(t=Promise))((function(t,i){function l(e){try{s(o.next(e))}catch(n){i(n)}}function r(e){try{s(o["throw"](e))}catch(n){i(n)}}function s(e){e.done?t(e.value):a(e.value).then(l,r)}s((o=o.apply(e,n||[])).next())}))},s=function(e,n){var t={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&n.indexOf(o)<0&&(t[o]=e[o]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var a=0;for(o=Object.getOwnPropertySymbols(e);a<o.length;a++)n.indexOf(o[a])<0&&Object.prototype.propertyIsEnumerable.call(e,o[a])&&(t[o[a]]=e[o[a]])}return t};const u=(0,o.aZ)({name:"DepartmentDialog",props:{id:Number,parentId:Number},emits:[...i.Z.emits],setup(e){const{dialogRef:n,onDialogHide:t,onDialogOK:u,onDialogCancel:d}=(0,i.Z)(),c=()=>({name:"",order:0,parentId:e.parentId||null}),p=(0,a.iH)(c()),m=(0,a.iH)(!1),{fetchDepartment:g,fetchDepartments:f}=(0,l.h)(),v=(0,a.iH)([]);(0,o.bv)((()=>r(this,void 0,void 0,(function*(){const{status:e,response:n}=yield f({tree:!1});e&&(v.value=n.departments)}))));const{id:h}=(0,a.BK)(e);(0,o.YP)(h,(e=>r(this,void 0,void 0,(function*(){if(p.value=c(),!e)return;m.value=!0;const{status:n,response:t}=yield g({id:e});n&&(p.value=(e=>{var{id:n,children:t}=e,o=s(e,["id","children"]);return o})(t)),m.value=!1}))),{immediate:!0});const Z=()=>r(this,void 0,void 0,(function*(){console.log(p.value)}));return{dialogRef:n,onDialogHide:t,onOKClick(){u()},onCancelClick:d,model:p,submit:Z,departments:v,isLoading:m}}})},9722:(e,n,t)=>{t.d(n,{Z:()=>u});var o=t(3673),a=t(1959),i=t(8519),l=t(724),r=t(1893),s=function(e,n,t,o){function a(e){return e instanceof t?e:new t((function(n){n(e)}))}return new(t||(t=Promise))((function(t,i){function l(e){try{s(o.next(e))}catch(n){i(n)}}function r(e){try{s(o["throw"](e))}catch(n){i(n)}}function s(e){e.done?t(e.value):a(e.value).then(l,r)}s((o=o.apply(e,n||[])).next())}))};const u=(0,o.aZ)({name:"signInDialog",props:{modelValue:Boolean},emits:["update:modelValue"],setup(e,{emit:n}){const t=(0,l.w)(e,"modelValue",n),u=(0,a.iH)({login:"",password:"",rememberMe:!1});(0,o.YP)(t,(e=>{e||(u.value.login="",u.value.password="",u.value.rememberMe=!1)}));const{setErrors:d,clearErrors:c,errorsMap:p}=(0,r.p)(),{signIn:m,isSigningIn:g}=(0,i.a)(),f=(0,a.iH)(),v=(0,a.iH)(),h=()=>s(this,void 0,void 0,(function*(){var e,n;c();const{status:t,response:o}=yield m(u.value);t||(d(o),u.value.password="",null===(e=f.value)||void 0===e||e.shake(),null===(n=v.value)||void 0===n||n.focus())}));return{localValue:t,model:u,errorsMap:p,submit:h,dialogRef:f,isSigningIn:g,loginInputRef:v}}})},7319:(e,n,t)=>{t.d(n,{Z:()=>s});var o=t(3673),a=t(8519),i=t(2180),l=t(9951),r=t(5163);const s=(0,o.aZ)({name:"MainLayout",components:{SignInDialog:i.Z},setup(){const{isAuthorized:e,userData:n,signOut:t,isSigningOut:i,can:s}=(0,a.a)(),[u,d,c]=(0,l.O)();(0,o.YP)(e,(e=>{e&&c(!1)}),{immediate:!0}),(0,o.YP)(u,(n=>{n&&e.value&&c(!1)}),{immediate:!0});const{isEditing:p}=(0,r.j)();return{userData:n,isAuthorized:e,isSignInDialogVisible:u,toggleSignInDialog:d,signOut:t,isSigningOut:i,isEditing:p,can:s}}})},8519:(e,n,t)=>{t.d(n,{a:()=>l});var o=t(2394),a=t(1959),i=function(e,n,t,o){function a(e){return e instanceof t?e:new t((function(n){n(e)}))}return new(t||(t=Promise))((function(t,i){function l(e){try{s(o.next(e))}catch(n){i(n)}}function r(e){try{s(o["throw"](e))}catch(n){i(n)}}function s(e){e.done?t(e.value):a(e.value).then(l,r)}s((o=o.apply(e,n||[])).next())}))};const l=()=>{const e=(0,o.useStore)(),n=(0,a.Fl)((()=>e.getters["auth/isAuthorized"])),t=(0,a.Fl)((()=>e.getters["auth/data"])),l=(0,a.Fl)((()=>e.getters["auth/isSigningIn"])),r=(0,a.Fl)((()=>e.getters["auth/isSigningOut"])),s=n=>i(void 0,void 0,void 0,(function*(){return e.dispatch("auth/signIn",n)})),u=()=>i(void 0,void 0,void 0,(function*(){return e.dispatch("auth/signOut")})),d=(0,a.Fl)((()=>e=>{var n;return(e instanceof Array?e:[e]).includes(null===(n=t.value)||void 0===n?void 0:n.role)}));return{isAuthorized:n,userData:t,signIn:s,signOut:u,isSigningIn:l,isSigningOut:r,can:d}}},2734:(e,n,t)=>{t.d(n,{h:()=>i});var o=t(2394),a=function(e,n,t,o){function a(e){return e instanceof t?e:new t((function(n){n(e)}))}return new(t||(t=Promise))((function(t,i){function l(e){try{s(o.next(e))}catch(n){i(n)}}function r(e){try{s(o["throw"](e))}catch(n){i(n)}}function s(e){e.done?t(e.value):a(e.value).then(l,r)}s((o=o.apply(e,n||[])).next())}))};const i=()=>{const e=(0,o.useStore)(),n=({tree:n=!0,parentId:t}={})=>a(void 0,void 0,void 0,(function*(){return e.dispatch("departments/fetchDepartments",{tree:n,parentId:t})})),t=n=>a(void 0,void 0,void 0,(function*(){return e.dispatch("departments/fetchDepartment",n)})),i=n=>a(void 0,void 0,void 0,(function*(){return e.dispatch("departments/fetchDepartmentPersons",n)})),l=n=>a(void 0,void 0,void 0,(function*(){return e.dispatch("departments/fetchDepartmentPerson",n)}));return{fetchDepartments:n,fetchDepartment:t,fetchDepartmentPerson:l,fetchDepartmentPersons:i}}},5163:(e,n,t)=>{t.d(n,{j:()=>r});var o=t(2394),a=t(1959),i=t(8075),l=t(969);const r=()=>{const e=(0,o.useStore)(),n=(0,a.Fl)({get(){return e.getters.isEditing},set(n){e.commit("setIsEditing",n)}}),t=(0,i.Z)(),r=e=>{t.dialog({title:"Редактирование департамента",component:l.Z,componentProps:e})},s=e=>{console.log(e)};return{isEditing:n,showDepartmentDialog:r,showDepartmentsSortDialog:s}}},1893:(e,n,t)=>{t.d(n,{p:()=>i});var o=t(1959),a=t(4963);const i=()=>{const e=(0,o.iH)([]),n=(0,o.Fl)((()=>e.value.reduce(((e,[n,t])=>Object.assign(Object.assign({},e),{[n]:(0,a.O)(t)})),{}))),t=n=>{e.value.push(...n instanceof Array?n:Object.entries(n))},i=()=>{e.value=[]};return{errorsMap:n,setErrors:t,clearErrors:i}}},724:(e,n,t)=>{t.d(n,{w:()=>a});var o=t(1959);const a=(e,n,t)=>(0,o.Fl)({get(){return e[n]},set(e){t("update:modelValue",e)}})},9951:(e,n,t)=>{t.d(n,{O:()=>a});var o=t(1959);const a=(e=!1,n=!0,t=!1)=>{const a=(0,o.iH)(e),i=()=>{a.value=a.value===n?t:n},l=e=>{a.value=e};return[a,i,l]}},4963:(e,n,t)=>{t.d(n,{O:()=>o});const o=e=>e instanceof Array?e:[e]},969:(e,n,t)=>{t.d(n,{Z:()=>v});var o=t(6030),a=t(9601),i=t(7066),l=t(8757),r=t(7217),s=t(323),u=t(9804),d=t(9181),c=t(3479),p=t(648),m=t(7518),g=t.n(m);const f=a.Z.__cssModules={};f["$style"]=i.Z,a.Z.render=o.s;const v=a.Z;g()(a.Z,"components",{QDialog:l.Z,QCard:r.Z,QCardSection:s.Z,QInput:u.Z,QSelect:d.Z,QCardActions:c.Z,QBtn:p.Z})},2180:(e,n,t)=>{t.d(n,{Z:()=>h});var o=t(9827),a=t(8487),i=t(2177),l=t(8757),r=t(7217),s=t(323),u=t(9804),d=t(3984),c=t(3479),p=t(648),m=t(1622),g=t(7518),f=t.n(g);const v=a.Z.__cssModules={};v["$style"]=i.Z,a.Z.render=o.s;const h=a.Z;f()(a.Z,"components",{QDialog:l.Z,QCard:r.Z,QCardSection:s.Z,QInput:u.Z,QCheckbox:d.Z,QCardActions:c.Z,QBtn:p.Z}),f()(a.Z,"directives",{ClosePopup:m.Z})},2754:(e,n,t)=>{t.r(n),t.d(n,{default:()=>g});var o=t(1585),a=t(865),i=t(4145),l=t(7754),r=t(8056),s=t(366),u=t(648),d=t(3984),c=t(6832),p=t(7518),m=t.n(p);a.Z.render=o.s;const g=a.Z;m()(a.Z,"components",{QLayout:i.Z,QHeader:l.Z,QToolbar:r.Z,QToolbarTitle:s.Z,QBtn:u.Z,QCheckbox:d.Z,QPageContainer:c.Z})},7489:(e,n,t)=>{t.d(n,{Z:()=>o});const o={dialog:"DepartmentDialog_dialog_kOVUc"}},9720:(e,n,t)=>{t.d(n,{Z:()=>o});const o={dialog:"SignInDialog_dialog_1OR0m"}},6030:(e,n,t)=>{t.d(n,{s:()=>o.s});var o=t(1879)},9827:(e,n,t)=>{t.d(n,{s:()=>o.s});var o=t(6960)},9601:(e,n,t)=>{t.d(n,{Z:()=>o.Z});var o=t(2150)},8487:(e,n,t)=>{t.d(n,{Z:()=>o.Z});var o=t(9722)},865:(e,n,t)=>{t.d(n,{Z:()=>o.Z});var o=t(7319)},7066:(e,n,t)=>{t.d(n,{Z:()=>o.Z});var o=t(7489)},2177:(e,n,t)=>{t.d(n,{Z:()=>o.Z});var o=t(9720)}}]);